#!/bin/sh

pwd
ls
ls "$1/.heroku-bundle"

echo "Old .bundle/config contents"
cat "$1/.bundle/config"
echo "Cache .bundle/config contents"
cat "$2/.bundle/config"

echo "Purging .bundle folder if present"
[ -d "$1/.bundle" ] && rm -rf "$1/.bundle"
echo "Renaming heroku-bundle"
mv "$1/.heroku-bundle" "$1/.bundle"
echo "Done."

echo "Convert all aboslute path references in the bundle to refer the temporary build location instead."
sed "s /app/ /$1/ g" "$1/.bundle/*"

echo "Purging .bundle folder if present from cache as well"
[ -d "$2/.bundle" ] && rm -rf "$2/.bundle"
echo "Caching the changes.."
mkdir -p "$2"
cp -r "$1/.bundle" "$2/.bundle"

sed: can't read /tmp/build_c982f0d9-9b66-42e6-a875-0a681a1e47fb/.bundle/*: No such file or directory
